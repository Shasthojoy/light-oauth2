<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Key Distribution - Light OAuth2 - OAuth2 Serivces based on light-4j</title>
    <meta name="generator" content="Hugo 0.20.6" />

    
    <meta name="description" content="Light OAuth2 Docs">
    
    <link rel="canonical" href="https://networknt.github.io/light-oauth2/services/key/">
    
    <meta name="author" content="Steve Hu">
    

    <meta property="og:url" content="https://networknt.github.io/light-oauth2/services/key/">
    <meta property="og:title" content="Light OAuth2 - OAuth2 Serivces based on light-4j">
    <meta property="og:image" content="https://networknt.github.io/light-oauth2/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Light OAuth2 - OAuth2 Serivces based on light-4j">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://networknt.github.io/light-oauth2/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://networknt.github.io/light-oauth2/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://networknt.github.io/light-oauth2/fonts/icon.eot');
        src: url('https://networknt.github.io/light-oauth2/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://networknt.github.io/light-oauth2/fonts/icon.woff')
               format('woff'),
             url('https://networknt.github.io/light-oauth2/fonts/icon.ttf')
               format('truetype'),
             url('https://networknt.github.io/light-oauth2/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://networknt.github.io/light-oauth2/stylesheets/application.css">
    <link rel="stylesheet" href="https://networknt.github.io/light-oauth2/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://networknt.github.io/light-oauth2/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://networknt.github.io/light-oauth2/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="https://networknt.github.io/light-oauth2/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-red palette-accent-teal">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Key Distribution
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/stevehu" title="@stevehu on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://github.com/networknt/light-oauth2" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://networknt.github.io/light-oauth2/images/logo.png">
        </div>
      
      <div class="name">
        <strong>Light OAuth2 - OAuth2 Serivces based on light-4j <span class="version">1.4.3</span></strong>
        
          <br>
          networknt/light-oauth2
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://github.com/networknt/light-oauth2/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/networknt/light-oauth2/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Getting started" href="https://networknt.github.io/light-oauth2/getting-started/">
	
	Getting started
</a>



  
</li>



<li>
  
    



<a  title="Architecture" href="https://networknt.github.io/light-oauth2/architecture/">
	
	Architecture
</a>



  
</li>



<li>
  
    



<a  title="Services" href="https://networknt.github.io/light-oauth2/services/">
	
	Services
</a>



  
</li>



<li>
  
    



<a  title="Tutorials" href="https://networknt.github.io/light-oauth2/tutorials/">
	
	Tutorials
</a>



  
</li>



<li>
  
    



<a  title="Examples" href="https://networknt.github.io/light-oauth2/example/">
	
	Examples
</a>



  
</li>



<li>
  
    



<a  title="Tools" href="https://networknt.github.io/light-oauth2/tools/">
	
	Tools
</a>



  
</li>



<li>
  
    



<a  title="References" href="https://networknt.github.io/light-oauth2/reference/">
	
	References
</a>



  
</li>



<li>
  
    



<a  title="Issues &amp; Help" href="https://github.com/networknt/light-oauth2/issues">
	
	Issues &amp; Help
</a>



  
</li>



<li>
  
    



<a  title="Roadmap" href="https://networknt.github.io/light-oauth2/roadmap/">
	
	Roadmap
</a>



  
</li>



<li>
  
    



<a  title="License" href="https://www.apache.org/licenses/LICENSE-2.0">
	
	License
</a>



  
</li>



<li>
  
    



<a  title="Introduction" href="https://networknt.github.io/light-oauth2/index.html">
	
	Introduction
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          

          
          <li>
            <a href="https://github.com/stevehu" target="_blank" title="@stevehu on GitHub">
              @stevehu on GitHub
            </a>
          </li>
          

          
          <li>
            <a href="mailto:stevehu@gmail.com" title="Email of stevehu@gmail.com">
              Contact via email
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Key Distribution </h1>

			

<h1 id="key">Key</h1>

<p>In microservices architecture, the traditional way of copying public key certificates
to hosts of services is not working. With container orchestration tool like Kubernetes
old containers can be shutdown and new container can be started at anytime. So the push
certificates to services has to be changed to pull certificates from OAuth2 server
instead. This service is designed to pull public key certificate based on keyId that is
in the JWT token header. It is tightly integrated with light-4j framework security
component.</p>

<p>For more information on how light-4j security module integrates with this service, please
refer to <a href="https://networknt.github.io/light-4j/architecture/key-distribution/">key distribution</a></p>

<p>This service is listening to port number 6886.</p>

<p>Here is the specification</p>

<pre><code>swagger: '2.0'

info:
  version: &quot;1.0.0&quot;
  title: OAuth2 Key Service
  description: OAuth2 Key Service microservices endpoints. 
  contact:
    email: stevehu@gmail.com
  license:
    name: &quot;Apache 2.0&quot;
    url: &quot;http://www.apache.org/licenses/LICENSE-2.0.html&quot;
host: oauth2.networknt.com
schemes:
  - http
  - https

consumes:
  - application/json
produces:
  - application/json

paths:
  /oauth2/key/{keyId}:
    get:
      description: Get a key by Id
      operationId: getKeyById
      parameters:
      - name: &quot;keyId&quot;
        in: &quot;path&quot;
        description: &quot;Key Id&quot;
        required: true
        type: &quot;string&quot;
      responses:
        200: 
          description: Successful response
          schema:
            $ref: &quot;#/definitions/Key&quot;          
        400:
          description: &quot;Invalid keyId supplied&quot;
        404:
          description: &quot;Key not found&quot;
      security:
        - key_auth:
          - oauth.key.r
          - oauth.key.w

securityDefinitions:
  key_auth:
    type: &quot;oauth2&quot;
    authorizationUrl: &quot;http://localhost:8888/oauth2/code&quot;
    flow: &quot;implicit&quot;
    scopes:
      oauth.key.w: &quot;write key&quot;
      oauth.key.r: &quot;read key&quot;
definitions:
  Key:
    type: &quot;object&quot;
    required:
    - &quot;keyId&quot;
    - &quot;certificate&quot;
    properties:
      keyId:
        type: &quot;string&quot;
        description: &quot;a unique id&quot;
      certificate:
        type: &quot;string&quot;
        description: &quot;certificate&quot;

</code></pre>

<h2 id="oauth2-key-keyid-get">/oauth2/key/{keyId}@get</h2>

<p>This endpoint is used to get public key certificate for JWT signature verification based
on keyId in the JWT header. Light-Java framework should have packaged with several keys
already when deployed to production, however, keys are changing frequently as old ones
are expired. You don&rsquo;t want to redeploy your services just due to key changes on the
OAuth server. This endpoint is available for all services which have an entry in client
table so that clientId and clientSecret can be used to verify the identity of the service.</p>

<p>The following validations are performed before the key is issued by the service.</p>

<ul>
<li>If authorization header doesn&rsquo;t exist in the request, the following error will be
returned.</li>
</ul>

<pre><code>  &quot;ERR12002&quot;: {
    &quot;statusCode&quot;: 401,
    &quot;code&quot;: &quot;ERR12002&quot;,
    &quot;message&quot;: &quot;MISSING_AUTHORIZATION_HEADER&quot;,
    &quot;description&quot;: &quot;Missing authorization header. client credentials must be passed in as Authorization header.&quot;
  }
</code></pre>

<ul>
<li>If the client secret is not correct when matching with hashed and salted client secret
in cache, then the following error will be returned.</li>
</ul>

<pre><code>  &quot;ERR12007&quot;: {
    &quot;statusCode&quot;: 401,
    &quot;code&quot;: &quot;ERR12007&quot;,
    &quot;message&quot;: &quot;UNAUTHORIZED_CLIENT&quot;,
    &quot;description&quot;: &quot;Unauthorized client with wrong client secret.&quot;
  }
</code></pre>

<ul>
<li>If the client id in the authorization header doesn&rsquo;t exist in client cache in memory,
then the following error will be returned.</li>
</ul>

<pre><code>  &quot;ERR12014&quot;: {
    &quot;statusCode&quot;: 404,
    &quot;code&quot;: &quot;ERR12014&quot;,
    &quot;message&quot;: &quot;CLIENT_NOT_FOUND&quot;,
    &quot;description&quot;: &quot;Client %s is not found.&quot;
  }
</code></pre>

<ul>
<li>If the keyId cannot be found on the server, then the following error will be returned.</li>
</ul>

<pre><code>  &quot;ERR10010&quot;: {
    &quot;statusCode&quot;: 500,
    &quot;code&quot;: &quot;ERR10010&quot;,
    &quot;message&quot;: &quot;RUNTIME_EXCEPTION&quot;,
    &quot;description&quot;: &quot;Unexpected runtime exception&quot;
  }
</code></pre>


			<aside class="copyright" role="note">
				
				&copy; 2017 Released under the MIT license &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://networknt.github.io/light-oauth2/services/refresh-token/" title="Refresh Token">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Refresh Token
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://networknt.github.io/light-oauth2/services/user/" title="User Management">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              User Management
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/networknt.github.io\/light-oauth2\/';
      var repo_id  = 'networknt\/light-oauth2';
    
    </script>

    <script src="https://networknt.github.io/light-oauth2/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

